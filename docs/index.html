<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pen Plotter Project: Pen Plotter Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="CPME Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pen Plotter Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Pen Plotter Project </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sftware"></a>
Software Design</h1>
<p >This section includes information regarding our pen plottor robot software design. Below in Figure 1 is a task diagram of all information that will be shared between tasks to accomplish our goal. To operate the robot, the user will run the main file and input an HPGL file that will be processed. The main file will then call the Processing Task which will place the current command (Pen Up or Pen Down) and the theta positions in revolutions that will be input to the radial, rotational, and servo tasks. The servo task will output a 0 or a 1 to the servoDriver based on whether the Pen needs to be UP (1) or DOWN (0). The radial and rotational tasks will output the setPoint in ticks to the controller task which calls the encoder task to calculate a duty cycle based on the proportional gain and encoder read values. This duty cycle is then input into the motor driver task to drive the motor. <br  />
 </p><div class="image">
<img src="UpdatedTaskDiagram.png" alt=""/>
<div class="caption">
Figure 1: Squiggly Task Diagram</div></div>
<p> <br  />
</p>
<p >The previous Task Diagram could also be seen below in Figure 2. Some changes that we made are that we opted to have all the processing performed on the Nucleo, and we decided to have the User Interface built into the main file. </p><div class="image">
<img src="TaskDiagram.png" alt=""/>
<div class="caption">
Figure 2: Previous Task Diagram</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="task_process"></a>
Processing Task</h2>
<p >Once the user has input a drawing the processing task will convert the drawing to X and Y coordinates. From those X and Y coordinates, inverse kinematics will be used to translate X/Y to theta 1 and theta 2 motor positions in revolutions. This information is then added to two different queues and sent to either the Rotation or Radial tasks. A third queue called curCommand is also filled. This queue contains bits with the command Pen up (1) or Pen down (0). The curCommand queue is sent to the servo task <br  />
</p>
<div class="image">
<img src="Parse_Task.png" alt=""/>
<div class="caption">
Figure 3: Processing Task FSM</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="task_rotation_radial"></a>
Rotation and Radial Task</h2>
<p >The rotation and radial tasks control the respective motor drivers, controllers, and encoders related to each motor. The rotation and radial task perform exactly the same so both will be described here. Once the theta 1 and theta 2 positions are in their respective queues, the desired setPoint in ticks is sent to the controller task. The controller task then calls the Encoder Reader to get the current position and returns a desired duty cycle to the rotation/radial task. This duty cycle is then inputted into the motor driver task. <br  />
</p>
<div class="image">
<img src="Rotation_Radial_Task.png" alt=""/>
<div class="caption">
Figure 4: Rotational and Radial Task FSM</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="task_servo"></a>
Servo Task</h2>
<p >Servo task will initiate and alternate between two states: Pen Up or Pen Down depending on the desired command put in the curCommand queue. The desired mode is then sent to the servo driver. <br  />
</p>
<div class="image">
<img src="Servo_Task.png" alt=""/>
<div class="caption">
Figure 5: Servo Task FSM</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="task_controller"></a>
Controller Task</h2>
<p >Task controller will wait for a provided setPoint from the Rotation or Radial Tasks and use path data with a proportional gain input to send PWM signals to respective motors tasks. <br  />
</p>
<div class="image">
<img src="Controller_Task.png" alt=""/>
<div class="caption">
Figure 6: Controller Task FSM</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="motor_driver"></a>
Motor Driver</h2>
<p >Task motor driver will recieve PWM duty cycles from the rotation or radial tasks and apply the signal to instantiated motors. <br  />
</p>
<h2><a class="anchor" id="servo_driver"></a>
Servo Driver</h2>
<p >Task servo driver will receive curMode commands from the servo task and apply the signal to the servo. <br  />
</p>
<h2><a class="anchor" id="task_encoder"></a>
Encoder Reader</h2>
<p >Task encoder will be the highest priority, constantly sending motor positions for radial and angular motors. Task controller will receive these values and interpret them to vary PWM for motors.<br  />
 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
